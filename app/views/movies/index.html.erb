<div class="container mx-auto px-4 py-12 bg-gray-50 min-h-screen">
  <h1 class="text-4xl md:text-5xl font-extrabold mb-12 text-center text-gray-800">
    <%= t('movies.catalog_title') %>
  </h1>

  <!-- Filtros -->
  <div class="mb-8 flex flex-wrap justify-center gap-4">
    <%= form_with url: movies_path, method: :get, local: true, class: "flex flex-wrap gap-2 items-center justify-center" do %>
      <div>
        <%= select_tag :category, 
              options_from_collection_for_select(Category.all, :name, :name, params[:category]), 
              include_blank: t('movies.filters.category'), 
              class: "mt-1 block w-40 bg-white border border-gray-300 rounded-md px-3 py-2 text-gray-700 text-sm focus:ring-1 focus:ring-blue-400 focus:border-blue-400" %>
      </div>

      <div>
        <%= number_field_tag :year, params[:year], placeholder: t('movies.filters.year'), class: "mt-1 block w-20 bg-white border border-gray-300 rounded-md px-3 py-2 text-gray-700 text-sm focus:ring-1 focus:ring-blue-400 focus:border-blue-400" %>
      </div>

      <div>
        <%= text_field_tag :director, params[:director], placeholder: t('movies.filters.director'), class: "mt-1 block w-44 bg-white border border-gray-300 rounded-md px-3 py-2 text-gray-700 text-sm focus:ring-1 focus:ring-blue-400 focus:border-blue-400" %>
      </div>

      <div>
        <%= submit_tag t('movies.filters.submit'), class: "mt-1 bg-blue-600 text-white px-4 py-2 rounded-md text-sm hover:bg-blue-700 transition-colors duration-200" %>
      </div>
    <% end %>
  </div>

  <% if @movies.any? %>
    <div class="flex flex-wrap justify-center gap-6">
      <% @movies.each do |movie| %>
        <%= link_to movie_path(movie), class: "relative group block bg-white rounded-xl shadow-lg overflow-hidden transition-shadow duration-300 hover:shadow-2xl w-[300px] h-[440px]" do %>

          <% if movie.cover_image.attached? %>
            <%= image_tag movie.cover_image.variant(resize_to_fill: [300, 400]), class: "w-full h-[400px] object-cover" %>
          <% else %>
            <div class="w-full h-[400px] bg-gray-200 flex items-center justify-center text-gray-400">
              <%= t('movies.no_image') %>
            </div>
          <% end %>

          <!-- Título fora da imagem -->
          <div class="bg-gray-800 text-white px-3 py-2 text-center">
            <h2 class="text-base font-bold truncate"><%= movie.title %></h2>
          </div>

          <div class="absolute inset-0 bg-black bg-opacity-10 text-white p-4 flex flex-col justify-center items-start opacity-0 group-hover:opacity-80 transition-opacity duration-300">
            <h2 class="text-xl font-bold mb-2"><%= movie.title %></h2>
            <p class="text-sm mb-2"><%= movie.release_year %> • <%= movie.duration %> <%= t('movies.duration_minutes') %></p>
            <p class="text-sm mb-4"><%= truncate(movie.synopsis, length: 80) %></p>
            <span class="text-yellow-500 px-3 py-1 rounded"><%= t('movies.view_details') %></span>
          </div>
        <% end %>
      <% end %>
    </div>

    <div class="mt-12 flex justify-center">
      <nav aria-label="Pagination">
        <ul class="inline-flex items-center space-x-2">
          <% if @movies.prev_page %>
            <%= link_to '‹', movies_path(page: @movies.prev_page, category: params[:category], year: params[:year], director: params[:director]),
              class: "px-3 py-2 rounded-full bg-gray-200 hover:bg-gray-300 text-gray-700" %>
          <% else %>
            <span class="px-3 py-2 rounded-full bg-gray-100 text-gray-400 cursor-not-allowed">‹</span>
          <% end %>

          <% (@movies.current_page - 2..@movies.current_page + 2).each do |page| %>
            <% next if page < 1 || page > @movies.total_pages %>
            <li>
              <% if page == @movies.current_page %>
                <span class="px-4 py-2 rounded-full bg-blue-600 text-white font-semibold"><%= page %></span>
              <% else %>
                <%= link_to page, movies_path(page: page, category: params[:category], year: params[:year], director: params[:director]),
                  class: "px-4 py-2 rounded-full bg-gray-200 hover:bg-gray-300 text-gray-700" %>
              <% end %>
            </li>
          <% end %>

          <% if @movies.next_page %>
            <%= link_to '›', movies_path(page: @movies.next_page, category: params[:category], year: params[:year], director: params[:director]),
              class: "px-3 py-2 rounded-full bg-gray-200 hover:bg-gray-300 text-gray-700" %>
          <% else %>
            <span class="px-3 py-2 rounded-full bg-gray-100 text-gray-400 cursor-not-allowed">›</span>
          <% end %>
        </ul>
      </nav>
    </div>

  <% else %>
    <p class="text-center text-gray-500 text-lg mt-12"><%= t('movies.no_movies_found') %></p>
  <% end %>
</div>
